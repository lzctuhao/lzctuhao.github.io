/*!
 * jQCloud Plugin for jQuery
 *
 * Version 1.0.4
 *
 * Copyright 2011, Luca Ongaro
 * Licensed under the MIT license.
 *
 * Date: 2013-05-09 18:54:22 +0200
*/
(function(e){"use strict";e.fn.jQCloud=function(t,i){var n=this,h=n.attr("id")||Math.floor(Math.random()*1e6).toString(36),r={width:n.width(),height:n.height(),center:{x:(i&&i.width?i.width:n.width())/2,y:(i&&i.height?i.height:n.height())/2},delayedMode:t.length>50,shape:!1,encodeURI:!0,removeOverflowing:!0};i=e.extend(r,i||{}),n.addClass("jqcloud").width(i.width).height(i.height),n.css("position")==="static"&&n.css("position","relative");var a=function(){var r=function(e,t){var i=function(e,t){return Math.abs(2*e.offsetLeft+e.offsetWidth-2*t.offsetLeft-t.offsetWidth)<e.offsetWidth+t.offsetWidth&&Math.abs(2*e.offsetTop+e.offsetHeight-2*t.offsetTop-t.offsetHeight)<e.offsetHeight+t.offsetHeight?!0:!1},n=0;for(n=0;n<t.length;n++)if(i(e,t[n]))return!0;return!1};for(var a=0;a<t.length;a++)t[a].weight=parseFloat(t[a].weight,10);t.sort((function(e,t){return e.weight<t.weight?1:e.weight>t.weight?-1:0}));var o=i.shape==="rectangular"?18:2,s=[],f=i.width/i.height,d=function(a,d){var l=h+"_word_"+a,c="#"+l,g=6.28*Math.random(),u=0,w=0,p=0,m=5,v="",M="",x;d.html=e.extend(d.html,{id:l}),d.html&&d.html["class"]&&(v=d.html["class"],delete d.html["class"]),t[0].weight>t[t.length-1].weight&&(m=Math.round((d.weight-t[t.length-1].weight)/(t[0].weight-t[t.length-1].weight)*9)+1),x=e("<span>").attr(d.html).addClass("w"+m+" "+v),d.link?(typeof d.link=="string"&&(d.link={href:d.link}),i.encodeURI&&(d.link=e.extend(d.link,{href:encodeURI(d.link.href).replace(/'/g,"%27")})),M=e("<a>").attr(d.link).text(d.text)):M=d.text,x.append(M);if(!!d.handlers)for(var k in d.handlers)d.handlers.hasOwnProperty(k)&&typeof d.handlers[k]=="function"&&e(x).bind(k,d.handlers[k]);n.append(x);var y=x.width(),R=x.height(),b=i.center.x-y/2,C=i.center.y-R/2,W=x[0].style;W.position="absolute",W.left=b+"px",W.top=C+"px";while(r(x[0],s)){if(i.shape==="rectangular"){w++,w*o>(1+Math.floor(p/2))*o*(p%4%2===0?1:f)&&(w=0,p++);switch(p%4){case 1:b+=o*f+Math.random()*2;break;case 2:C-=o+Math.random()*2;break;case 3:b-=o*f+Math.random()*2;break;case 0:C+=o+Math.random()*2}}else u+=o,g+=(a%2===0?1:-1)*o,b=i.center.x-y/2+u*Math.cos(g)*f,C=i.center.y+u*Math.sin(g)-R/2;W.left=b+"px",W.top=C+"px"}if(i.removeOverflowing&&(b<0||C<0||b+y>i.width||C+R>i.height)){x.remove();return}s.push(x[0]),e.isFunction(d.afterWordRender)&&d.afterWordRender.call(x)},l=function(h){h=h||0;if(!n.is(":visible")){setTimeout((function(){l(h)}),10);return}h<t.length?(d(h,t[h]),setTimeout((function(){l(h+1)}),10)):e.isFunction(i.afterCloudRender)&&i.afterCloudRender.call(n)};i.delayedMode?l():(e.each(t,d),e.isFunction(i.afterCloudRender)&&i.afterCloudRender.call(n))};return setTimeout((function(){a()}),10),n}})(jQuery);