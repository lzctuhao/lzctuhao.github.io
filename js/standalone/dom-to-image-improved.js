(function(e){"use strict";var t=P();var n=b();var r=x();var i=A();var o=new Set;var a={imagePlaceholder:undefined,cacheBust:false,useCredentials:false};var u={toSvg:s,toPng:l,toJpeg:f,toBlob:h,toPixelData:c,toCanvas:d,impl:{fontFaces:r,images:i,util:t,inliner:n,options:{}}};if(typeof exports==="object"&&typeof module==="object")module.exports=u;else e.domtoimage=u;function s(e,n){n=n||{};m(n);return Promise.resolve(e).then((function(e){return g(e,n.filter,true)})).then(v).then(y).then(r).then((function(r){return w(r,n.width||t.width(e),n.height||t.height(e))}));function r(e){if(n.bgcolor)e.style.backgroundColor=n.bgcolor;if(n.width)e.style.width=n.width+"px";if(n.height)e.style.height=n.height+"px";if(n.style)Object.keys(n.style).forEach((function(t){e.style[t]=n.style[t]}));return e}}function c(e,n){return p(e,n||{}).then((function(n){return n.getContext("2d").getImageData(0,0,t.width(e),t.height(e)).data}))}function l(e,t){return p(e,t||{}).then((function(e){return e.toDataURL()}))}function f(e,t){t=t||{};return p(e,t).then((function(e){return e.toDataURL("image/jpeg",t.quality||1)}))}function h(e,n){return p(e,n||{}).then(t.canvasToBlob)}function d(e,t){return p(e,t||{})}function m(e){if(typeof e.imagePlaceholder==="undefined"){u.impl.options.imagePlaceholder=a.imagePlaceholder}else{u.impl.options.imagePlaceholder=e.imagePlaceholder}if(typeof e.cacheBust==="undefined"){u.impl.options.cacheBust=a.cacheBust}else{u.impl.options.cacheBust=e.cacheBust}if(typeof e.useCredentials==="undefined"){u.impl.options.useCredentials=a.useCredentials}else{u.impl.options.useCredentials=e.useCredentials}if(typeof e.only_style!="undefined"){u.impl.options.only_style=e.only_style}}function p(e,n){o.clear();return s(e,n).then(t.makeImage).then(t.delay(100)).then((function(t){var i=typeof n.scale!=="number"?1:n.scale;var o=r(e,i);var a=o.getContext("2d");if(t){a.scale(i,i);if(n.canvas&&n.canvas.width){o.width=n.canvas.width}if(n.canvas&&n.canvas.height){o.height=n.canvas.height}if(n.canvas){a.drawImage(t,n.canvas.sx||0,n.canvas.sy||0,n.canvas.sw||n.width,n.canvas.sh||n.height,n.canvas.dx||0,n.canvas.dy||0,n.canvas.dw||n.width,n.canvas.dh||n.height)}else{a.drawImage(t,0,0)}}return o}));function r(e,r){var i=document.createElement("canvas");i.width=(n.width||t.width(e))*r;i.height=(n.height||t.height(e))*r;if(n.bgcolor){var o=i.getContext("2d");o.fillStyle=n.bgcolor;o.fillRect(0,0,i.width,i.height)}return i}}function g(e,n,r){if(!r&&n&&!n(e))return Promise.resolve();return Promise.resolve(e).then(i).then((function(t){return a(e,t,n)})).then((function(t){return s(e,t)}));function i(e){if(e instanceof HTMLCanvasElement)return t.makeImage(e.toDataURL());return e.cloneNode(false)}function a(e,n,r){var i=e.tagName==="use"?u(e):e.childNodes;if(i.length===0)return Promise.resolve(n);return o(n,t.asArray(i),r).then((function(){return n}));function o(e,t,n){var r=Promise.resolve();t.forEach((function(t){r=r.then((function(){return g(t,n)})).then((function(t){if(t)e.appendChild(t)}))}));return r}}function u(e){var t=document.getElementById(e.href.baseVal.replace("#",""));return[t.cloneNode(true)]}function s(e,n){if(!(n instanceof Element))return n;return Promise.resolve().then(r).then(i).then(a).then(u).then((function(){return n}));function r(){r(window.getComputedStyle(e),n.style);if((t.isChrome()||t.isSafari())&&n.style.marker&&(n.tagName==="line"||n.tagName==="path")){n.style.marker=""}function r(e,n){if(e.cssText){n.cssText=e.cssText;if(t.isSafari()){n.cssText=n.cssText.replace(/box-shadow(.*?);/,"box-shadow:none!important;")}n.font=e.font}else r(e,n);function r(e,n){t.asArray(e).forEach((function(t){if(t=="font-family"){e.getPropertyValue(t).replace(/[ \"\']/g,"").split(",").forEach((function(e){o.add(e)}))}n.setProperty(t,e.getPropertyValue(t),e.getPropertyPriority(t))}))}}}function i(){[":before",":after"].forEach((function(e){r(e)}));function r(r){var i=window.getComputedStyle(e,r);var o=i.getPropertyValue("content");if(o===""||o==="none")return;var a=t.uid();var u=n.getAttribute("class");if(u){n.setAttribute("class",u+" "+a)}var s=document.createElement("style");s.appendChild(c(a,r,i));n.appendChild(s);function c(e,n,r){var i="."+e+":"+n;var o=r.cssText?a(r):u(r);return document.createTextNode(i+"{"+o+"}");function a(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}function u(e){return t.asArray(e).map(n).join("; ")+";";function n(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")}}}}}function a(){if(e instanceof HTMLTextAreaElement)n.innerHTML=e.value;if(e instanceof HTMLInputElement)n.setAttribute("value",e.value)}function u(){if(!(n instanceof SVGElement))return;n.setAttribute("xmlns","http://www.w3.org/2000/svg");if(!(n instanceof SVGRectElement))return;["width","height"].forEach((function(e){var t=n.getAttribute(e);if(!t)return;n.style.setProperty(e,t)}))}}}function v(e){return r.resolveAll().then((function(t){var n=document.createElement("style");e.appendChild(n);n.appendChild(document.createTextNode(t));return e}))}function y(e){return i.inlineAll(e).then((function(){return e}))}function w(e,n,r){return Promise.resolve(e).then((function(e){e.setAttribute("xmlns","http://www.w3.org/1999/xhtml");return(new XMLSerializer).serializeToString(e)})).then(t.escapeXhtml).then((function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+"</foreignObject>"})).then((function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+n+'" height="'+r+'">'+e+"</svg>"})).then((function(e){return"data:image/svg+xml;charset=utf-8,"+e}))}function P(){return{escape:h,parseExtension:t,mimeType:n,dataAsUrl:f,isDataUrl:r,canvasToBlob:o,resolveUrl:a,getAndEncode:l,uid:s(),delay:p,asArray:g,isChrome:d,isSafari:m,escapeXhtml:v,makeImage:c,width:y,height:w};function e(){var e="application/font-woff";var t="image/jpeg";return{woff:e,woff2:e,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:t,jpeg:t,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function t(e){var t=/\.([^\.\/]*?)(\?|$)/g.exec(e);if(t)return t[1];else return""}function n(n){var r=t(n).toLowerCase();return e()[r]||""}function r(e){return e.search(/^(data:)/)!==-1}function i(e){return new Promise((function(t){var n=window.atob(e.toDataURL().split(",")[1]);var r=n.length;var i=new Uint8Array(r);for(var o=0;o<r;o++)i[o]=n.charCodeAt(o);t(new Blob([i],{type:"image/png"}))}))}function o(e){if(e.toBlob)return new Promise((function(t){e.toBlob(t)}));return i(e)}function a(e,t){var n=document.implementation.createHTMLDocument();var r=n.createElement("base");n.head.appendChild(r);var i=n.createElement("a");n.body.appendChild(i);r.href=t;i.href=e;return i.href}function s(){var e=0;return function(){return"u"+t()+e++;function t(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function c(e){if(e==="data:,")return Promise.resolve();return new Promise((function(t,n){var r=new Image;if(u.impl.options.useCredentials){r.crossOrigin="use-credentials"}r.onload=function(){t(r)};r.onerror=n;r.src=e}))}function l(e){var t=3e4;if(u.impl.options.cacheBust){e+=(/\?/.test(e)?"&":"?")+(new Date).getTime()}return new Promise((function(n){var r=new XMLHttpRequest;r.onreadystatechange=a;r.ontimeout=s;r.responseType="blob";r.timeout=t;if(u.impl.options.useCredentials){r.withCredentials=true}r.open("GET",e,true);r.send();var i;if(u.impl.options.imagePlaceholder){var o=u.impl.options.imagePlaceholder.split(/,/);if(o&&o[1]){i=o[1]}}function a(){console.log(r.response);if(r.readyState!==4)return;if(r.status!==200){if(i){n(i)}else{c("cannot fetch resource: "+e+", status: "+r.status)}return}var t=new FileReader;t.onloadend=function(){var e=t.result.split(/,/)[1];n(e)};t.readAsDataURL(r.response)}function s(){if(i){n(i)}else{c("timeout of "+t+"ms occured while fetching resource: "+e)}}function c(e){console.error(e);n("")}}))}function f(e,t){return"data:"+t+";base64,"+e}function h(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function d(){return/chrome/i.test(navigator.userAgent)}function m(){return/safari/i.test(navigator.userAgent)}function p(e){return function(t){return new Promise((function(n){setTimeout((function(){n(t)}),e)}))}}function g(e){var t=[];var n=e.length;for(var r=0;r<n;r++)t.push(e[r]);return t}function v(e){return e.replace(/%/g,"%25").replace(/#/g,"%23").replace(/\n/g,"%0A")}function y(e){var t=P(e,"border-left-width");var n=P(e,"border-right-width");return e.scrollWidth+t+n}function w(e){var t=P(e,"border-top-width");var n=P(e,"border-bottom-width");return e.scrollHeight+t+n}function P(e,t){var n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}}function b(){var e=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:o,shouldProcess:n,impl:{readUrls:r,inline:i}};function n(t){return t.search(e)!==-1}function r(n){var r=[];var i;while((i=e.exec(n))!==null){r.push(i[1])}return r.filter((function(e){return!t.isDataUrl(e)}))}function i(e,n,r,i){return Promise.resolve(n).then((function(e){return r?t.resolveUrl(e,r):e})).then(i||t.getAndEncode).then((function(e){return t.dataAsUrl(e,t.mimeType(n))})).then((function(t){return e.replace(o(n),"$1"+t+"$3")}));function o(e){return new RegExp("(url\\(['\"]?)("+t.escape(e)+")(['\"]?\\))","g")}}function o(e,t,o){if(a())return Promise.resolve(e);return Promise.resolve(e).then(r).then((function(n){var r=Promise.resolve(e);n.forEach((function(e){r=r.then((function(n){return i(n,e,t,o)}))}));return r}));function a(){return!n(e)}}}function x(){return{resolveAll:e,impl:{readAll:r}};function e(){return r(document).then((function(e){return Promise.all(e.map((function(e){return e.resolve()})))})).then((function(e){return e.join("\n")}))}function r(){return Promise.resolve(t.asArray(document.styleSheets)).then(r).then(e).then((function(e){return e.map(i)}));function e(e){return e.filter((function(e){return e.type===CSSRule.FONT_FACE_RULE})).filter((function(e){return n.shouldProcess(e.style.getPropertyValue("src"))}))}function r(e){let n=typeof u.impl.options.only_style==="undefined"?false:u.impl.options.only_style;var r=[];e.forEach((function(e){if(n&&e.href&&e.href.indexOf(n)>-1||!n){if(Object.getPrototypeOf(e).hasOwnProperty("cssRules")){try{t.asArray(e.cssRules||[]).forEach(r.push.bind(r))}catch(t){console.warn("Error while reading CSS rules from "+e.href,t.toString())}}}}));return r}function i(e){return{resolve:function t(){var r=(e.parentStyleSheet||{}).href;if(o.has(e.style.fontFamily)){return n.inlineAll(e.cssText,r)}return Promise.resolve("")},src:function(){return e.style.getPropertyValue("src")}}}}}function A(){return{inlineAll:r,impl:{newImage:e}};function e(e){return{inline:n};function n(n){if(t.isDataUrl(e.src))return Promise.resolve();return Promise.resolve(e.src).then(n||t.getAndEncode).then((function(n){return t.dataAsUrl(n,t.mimeType(e.src))})).then((function(t){return new Promise((function(n,r){e.onload=n;e.onerror=n;e.src=t}))}))}}function r(i){if(!(i instanceof Element))return Promise.resolve(i);return o(i).then((function(){if(i instanceof HTMLImageElement)return e(i).inline();else return Promise.all(t.asArray(i.childNodes).map((function(e){return r(e)})))}));function o(e){var t=e.style.getPropertyValue("background");if(!t)return Promise.resolve(e);return n.inlineAll(t).then((function(t){e.style.setProperty("background",t,e.style.getPropertyPriority("background"))})).then((function(){return e}))}}}})(this);