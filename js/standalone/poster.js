window.addEventListener("load",(function(){$(".collapsible").collapsible();$("select").formSelect();$(".pic-eg").on("click",(function(){let e=$(this).css("background-image");pic_change(e)}));let e=localStorage.getItem("text-content");if(e){document.getElementById("content_edit").value=e;document.getElementById("content").innerHTML=e}if(/firefox/gi.test(navigator.userAgent)){cssvar_change("font-family","revert")}const t=(e,t)=>{let o;return function n(...r){const i=()=>{clearTimeout(o);e(...r)};clearTimeout(o);o=setTimeout(i,t)}};if("windowControlsOverlay"in navigator){o();navigator.windowControlsOverlay.addEventListener("geometrychange",t((e=>{o()}),200));function o(){const e=navigator.windowControlsOverlay.visible;if(e){document.querySelectorAll("header,#menu").forEach((e=>{e.classList.add("isOverlayVisible")}))}else{document.querySelectorAll("header,#menu").forEach((e=>{e.classList.remove("isOverlayVisible")}))}}}}));function pic_change(e){$("#result,#toppic").css("background-image",e);document.getElementById("pic").src=t(e);function t(e){var t=e;var o=/url\((.*)\)/;var n="";try{n=o.exec(t)[1].trim();n=n.replace(/["']/g,"")}catch(e){n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}return n}}function text_change(e,t){let o="";try{o=marked.parse(e,{breaks:true})}catch(t){o=`<p>${e}</p>`;o=o.replace(/\n/g,"</p><p>");console.log("md解析失败"+t)}$(`#${t}`).html(o);localStorage.setItem(`text-${t}`,e)}function check2val(e){let t=e.checked?0:1;let o=e.dataset.tf.split("|")[t];return o}function pic_source_type(e){$("[id*=pic_source_type]").hide();$(`#pic_source_type${e}`).show();if(e<=1)$("#tab3li").hide();else $("#tab3li").show();$(".tabs").tabs("updateTabIndicator")}function random_keyword(e){let t="";$.get(`https://pixabay.com/api/?key=6295509-b67e3d655066dca3360851316&per_page=10&q=${e}`,(function(o,n){for(i=0;i<9;i++){try{t+=`<div class="pic-eg" style="background-image:url('${o.hits[i].webformatURL}')"></div>`}catch(o){console.error(o);t+=`<div class="pic-eg" style="background-image:url('https://source.unsplash.com/80${i}x0/?${e}')"></div>`}}$("#pic_search_res").html(t);$(".pic-eg").on("click",(function(){let e=$(this).css("background-image");pic_change(e)}))}))}function pic_upload(e){var t=e.files[0];var o=window.URL.createObjectURL(t);pic_change(`url(${o})`)}function filter_reset(){document.getElementById("pic").setAttribute("style","");const e=[1,0,0,1,0,1,0];for(i=0;i<e.length;i++){$(`#tab3 div:eq(${i}) input`).val(`${e[i]}`);$(`#tab3 div:eq(${i}) span:eq(1)`).text(`${e[i]}`)}}function cssvar_change(){for(let e=0;e<arguments.length;e=e+2){try{let t=arguments[e],o=arguments[e+1];let n="";if(t.indexOf("filter")>-1)n="pic";else if(t.indexOf("text")>-1)n="text";else n="result";document.getElementById(n).style.setProperty(`--${t}`,o);let r=document.getElementById(t);if(r.tagName.toLocaleLowerCase()=="input"){if(r.type=="checkbox"){let e=r.dataset.tf.split("|")[0];if(o==e)r.checked=true;else r.checked=false}else{r.value=o.indexOf("#")>-1?o:parseFloat(o);let e=r.previousElementSibling;if(e.className.indexOf("switch-res")>-1)e.innerHTML=parseFloat(o)}}else if(r.tagName.toLocaleLowerCase()=="select"){let e=Array.prototype.slice.call(r.options).find((e=>e.value==o));e.selected=true;r.parentNode.children[0].value=e.text;r.parentNode.children[0].setAttribute("style",e.getAttribute("style"))}else throw`没有找到id为${t}的显示元素`}catch(t){console.error(`更改id为${arguments[e]}的input元素值或显示值失败：${t}`)}}}function sentence_type(e){$(".letter_opt, .quote_opt").hide();switch(e){case"quote":$(".quote_opt").show();$("#text").removeClass("letter");$("#text").attr("data-letter-b","");$("#text").attr("data-letter-e","");cssvar_change("text-align","center","text-indent","0em","text-color","#4d4135","text-padding1","6.5em","text-padding2","3.5em");break;case"notice":cssvar_change("font-family","方正仿宋","title-font-family","方正小标宋");case"letter":$(".letter_opt").show();$("#text").addClass("letter");$("#text").attr("data-letter-b","11");$("#text").attr("data-letter-e","2");cssvar_change("text-align","left");cssvar_change("text-indent","2em");pic_change("linear-gradient(rgb(249, 233, 220), rgb(249, 233, 220))");cssvar_change("text-color","#4d4135","border-style","solid","border-color","#dfd6c5","text-padding1","2.5em","text-padding2","0.9em");break}e=="letter"&&cssvar_change("font-family","思源宋体","title-font-family","inherit")}function letter_begin(e,t){e=e?"1":"0";t=t?"1":"0";$("#text").attr("data-letter-b",e+t)}function letter_end(e,t){e=e?1:0;t=t?1:0;$("#text").attr("data-letter-e",e+t)}function capture(e=0){if(!document.getElementById("pic").complete){Swal.fire({icon:"error",title:"背景图片尚未加载完成",html:"请等待背景图片加载完成，或更换背景为渐变填充。",showConfirmButton:true});return false}$("#filter,#result").css("border-radius",0);Swal.fire({imageUrl:"/medias/loading/hourglass.svg",imageWidth:100,imageHeight:100,imageAlt:"loading",title:"请稍后",html:"图片生成中，预计需要10秒<br>网页可能暂时无响应，请稍安勿躁",showConfirmButton:false,timer:3e4,timerProgressBar:true,allowOutsideClick:false}).then((e=>{if(e.dismiss===Swal.DismissReason.timer){Swal.fire("请再试一次","超时","error")}}));var t=document.getElementById("result");var o={scale:e==2?1:2.5,only_style:"/css/standalone/poster-result.css"};domtoimage.toPng(t,o).then((function(t){let o=new Image;o.src=t;let a=/firefox/gi.test(navigator.userAgent)?`<div class="firefox swal2-icon swal2-warning swal2-icon-show" style="display: flex;"><div class="swal2-icon-content">!</div></div><div class="firefox"><svg xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 100 100" version="1.1"><ellipse cx="50" cy="50" rx="24" ry="24" fill="#80e"></ellipse><path d="M50 42c-14-7-11-8-16-11-1-4-1-8 0-12-5 2-9 5-12 9-1-4-1.4-7-1-12C8 24 2 38 2 50c-0 31 26 49 48 49 22 0 48-16 48-49 0-5 0-9-3-16-9 21-23 40-45 40-8 0-23-4-23-25 7-2 16-3 23-7z" fill="#f73"></path><path d="M50 42c-17 6-20-8-35 0 3 6 7 7 11 7 0 20 12 26 24 26 19 0 37-9 45-41-7-17-23-19-29-34-9 6-15 14-16 26 12 0 24 10 24 24 0 15-14 23-24 23-5 0-19-2-21-17 2-6 8-8 16-9 3-1 4-3 5-5z" fill="#fc3"></path></svg> Firefox火狐浏览器可能<b class="text-color">不支持使用自定义字体和网络图片</b>。<br>如遇错误，请直接截图或使用Chrome或Edge浏览器。</div>`:false;switch(e){case 1:Swal.fire({html:`<img src="${t}" alt="生成图片" style="max-width:100%">`,footer:a,allowOutsideClick:false,showCloseButton:true,showConfirmButton:true,confirmButtonText:"下载",showCancelButton:true,cancelButtonText:"取消",showDenyButton:a?true:false,denyButtonText:"使用Edge浏览器打开",focusDeny:a?true:false,denyButtonColor:"#e64a19",customClass:{denyButton:"firefox"},preConfirm:()=>{if(window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)=="micromessenger"){alert("请长按图片保存")}else{n("分享图片",t);Swal.close()}return false},preDeny:()=>{window.open("microsoft-edge:https://lzc2002.tk/tools/tools-pc.html?src=/tools/poster/index.html");return false}});break;case 2:r(t);break;case 3:i(t);break;default:n("分享图片",t);break}$("#filter,#result").css("border-radius","5px")})).catch((function(e){console.warn(e);let t=/firefox/gi.test(navigator.userAgent)?`<div class="firefox swal2-icon swal2-warning swal2-icon-show" style="display: flex;"><div class="swal2-icon-content">!</div></div><div class="firefox"> 如在Firefox火狐浏览器内遇到错误，请尝试更换至Edge或Chrome浏览器。</div>`:false;Swal.fire({icon:"error",title:"请再试一次",html:"若错误持续出现，请更换背景图片。",footer:"错误信息："+e.toString(),showDenyButton:t?true:false,denyButtonText:"使用Edge浏览器打开",focusDeny:t?true:false,denyButtonColor:"#e64a19",preDeny:()=>{window.open("microsoft-edge:https://lzc2002.tk/tools/tools-pc.html?src=/tools/poster/index.html");return false}})}));function n(e,t){var o=document.createElement("a");o.href=t;o.download=e;let n=document.createEvent("MouseEvents");n.initMouseEvent("click",true,false,window,0,0,0,0,0,false,false,false,false,0,null);o.dispatchEvent(n);Swal.fire({icon:"success",title:"即将弹出下载窗口",timer:3e3})}function r(e){AV.init({appId:"3yz9VMMFTU7t2AjXwqOzRtJK-MdYXbMMI",appKey:"yWPKu7eizq6iQgRWuBlpRyPa",serverURL:"https://leancloud.lzc2002.tk",serverURLs:"https://leancloud.lzc2002.tk"});const t=AV.Object.extend("Poster");const o=new t;let n=document.getElementById("content").innerText;let r=document.getElementById("foot").innerText;let i=typeof returnCitySN!=="undefined"&&returnCitySN["cip"]?returnCitySN["cip"]:"-1";o.set("content",n);o.set("foot",r);o.set("dataurl",e);o.save().then((e=>{console.log(`保存成功。objectId: ${e.id}`);Swal.fire({icon:"success",title:"上传成功",html:`存档编号: ${e.id}`,confirmButtonText:"去看看",showCancelButton:true,cancelButtonText:"好的"}).then((e=>{if(e.value)window.open("/2022/1231/folder-others/ju-zhai-jie-guo/")}))}),(e=>{console.error("leancloud error:"+e);Swal.fire({icon:"error",title:"上传失败",confirmButtonText:"好的"})}))}async function i(e){try{const t=await fetch(e);const o=await t.blob();await navigator.clipboard.write([new ClipboardItem({[o.type]:o})]).then((()=>{Swal.fire({icon:"success",title:"复制成功",timer:3e3})}),(e=>{let t=e.toString().indexOf("Write permission denied")>-1?true:false;Swal.fire({title:t?"请允许剪切板权限":"复制失败",html:t?"剪切板访问被拒绝":"请直接下载图片",icon:"error",footer:e});console.error(e)}))}catch(e){Swal.fire({icon:"error",title:"复制失败",footer:e})}}}function random_quote(){sentence_type("quote");cssvar_change("text-color","#ffffff","border-style","none");const e={a:"japanese cartoon",b:"comic",c:"video game",d:"literature",e:"original",f:"blur",g:"wallpaper",h:"film",i:"中国风",j:"cloud",k:"philosophy",l:"snarky"};$.get("https://v1.hitokoto.cn/?time="+(new Date).getTime(),(function(t,o){$("#content").text(t.hitokoto);$("#foot").text(`${t.from_who?t.from_who:t.creator}《${t.from}》`);cssvar_change("filter-bright","0.4");let n="",r=100;$.get(`https://pixabay.com/api/?key=6295509-b67e3d655066dca3360851316&per_page=${r}&q=${e[t.type]}`,(function(o,i){try{let e=Math.floor(Math.random()*r);n=o.hits[e].webformatURL}catch(o){console.error(o);n="https://source.unsplash.com/800x0/?"+e[t.type]+"&"+(new Date).getTime()}pic_change(`url(${n})`)}))}))}function menu(e){let t=e.firstChild.firstChild.style;if(t.transform==""){t.transform="rotate(180deg)";document.getElementsByTagName("header")[0].style.display="block"}else{t.transform="";document.getElementsByTagName("header")[0].style.display="none"}}async function random_gpt(){let e=document.getElementById("content").innerText;let t=localStorage.getItem("gpt_key");const{value:o}=await Swal.fire({title:"Chat GPT API的密钥",inputLabel:"生成的内容将围绕："+e,input:"text",inputValue:t,showCancelButton:true,footer:`<a href="https://platform.openai.com/account/api-keys">获取API密钥</a>`,inputValidator:e=>{if(!e){return"You need to write something!"}}});if(o){t=o;localStorage.setItem("gpt_key",o);if(document.getElementById("gpt_res").innerHTML)document.getElementById("gpt_res").innerHTML="<p>生成中...上一次的结果：</p>"+document.getElementById("gpt_res").innerHTML;Swal.fire({title:"正在连接Chat GPT",html:"可关闭对话框，但不要关闭网页",imageUrl:"/medias/loading/hourglass.svg",imageWidth:100,imageHeight:100,imageAlt:"loading",showConfirmButton:false,confirmButtonText:"生成",showCloseButton:!0})}var n={url:"https://api.openai.com/v1/completions",method:"POST",timeout:0,headers:{Authorization:"Bearer "+t,"Content-Type":"application/json"},data:JSON.stringify({model:"text-davinci-003",prompt:`请围绕这句话进行文学创作（字数在100至150字之间）：${e}\n请不要在回答中复述这句话。`,max_tokens:1024,temperature:.2})};$.ajax(n).done((function(t){let o=t.choices[0].text.trim().replace(/\n{2,}/g,"\n");o="<p>“"+e+"”</p><p>"+o.replace(/\n/g,"</p><p>")+"</p>";document.getElementById("gpt_res").innerHTML=o;Swal.fire({title:"成功",icon:"question",html:"生成卡片？",confirmButtonText:"生成",showCancelButton:true}).then((e=>{if(e.value){sentence_type("letter");text_change(o,"content");letter_begin(0,0);letter_end(0,0);document.querySelectorAll("[id*=letter]").forEach((e=>e.checked=false));cssvar_change("text-padding1","0.8em")}}))})).fail((function(e){console.error(e.responseJSON);Swal.fire({title:"获取失败",icon:"error",footer:e.responseJSON.error.type=="invalid_request_error"?"API错误":"未知错误"})}))}