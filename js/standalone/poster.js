$(document).ready((function(){$(".collapsible").collapsible();$("select").formSelect();$(".pic-eg").on("click",(function(){let e=$(this).css("background-image");pic_change(e)}))}));function pic_change(e){$("#result,#toppic").css("background-image",e);document.getElementById("pic").src=t(e);function t(e){var t=e;var r=/url\((.*)\)/;var i="";try{i=r.exec(t)[1].trim();i=i.replace(/["']/g,"")}catch(e){i="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}return i}}function text_change(e,t){let r="";try{r=marked.parse(e,{breaks:true})}catch(t){r=`<p>${e}</p>`;r=r.replace(/\n/g,"</p><p>");console.log("md解析失败"+t)}$(`#${t}`).html(r)}function check2val(e){let t=e.checked?0:1;let r=e.dataset.tf.split("|")[t];return r}function pic_source_type(e){$("[id*=pic_source_type]").hide();$(`#pic_source_type${e}`).show();if(e<=1)$("#tab3li").hide();else $("#tab3li").show();$(".tabs").tabs("updateTabIndicator")}function random_keyword(e){let t="";$.get(`https://pixabay.com/api/?key=6295509-b67e3d655066dca3360851316&per_page=10&q=${e}`,(function(r,o){for(i=0;i<9;i++){try{t+=`<div class="pic-eg" style="background-image:url('${r.hits[i].webformatURL}')"></div>`}catch(r){console.error(r);t+=`<div class="pic-eg" style="background-image:url('https://source.unsplash.com/80${i}x0/?${e}')"></div>`}}$("#pic_search_res").html(t);$(".pic-eg").on("click",(function(){let e=$(this).css("background-image");pic_change(e)}))}))}function pic_upload(e){var t=e.files[0];var r=window.URL.createObjectURL(t);pic_change(`url(${r})`)}function filter_reset(){document.getElementById("pic").setAttribute("style","");const e=[1,0,0,1,0,1,0];for(i=0;i<e.length;i++){$(`#tab3 div:eq(${i}) input`).val(`${e[i]}`);$(`#tab3 div:eq(${i}) span:eq(1)`).text(`${e[i]}`)}}function cssvar_change(){for(let e=0;e<arguments.length;e=e+2){try{let t=arguments[e],r=arguments[e+1];let i="";if(t.indexOf("filter")>-1)i="pic";else if(t.indexOf("text")>-1)i="text";else i="result";document.getElementById(i).style.setProperty(`--${t}`,r);let o=document.getElementById(t);if(o.tagName.toLocaleLowerCase()=="input"){if(o.type=="checkbox"){let e=o.dataset.tf.split("|")[0];if(r==e)o.checked=true;else o.checked=false}else{o.value=r.indexOf("#")>-1?r:parseFloat(r);let e=o.previousElementSibling;if(e.className.indexOf("switch-res")>-1)e.innerHTML=parseFloat(r)}}else if(o.tagName.toLocaleLowerCase()=="select"){let e=Array.prototype.slice.call(o.options).find((e=>e.value==r));e.selected=true;o.parentNode.children[0].value=e.text;o.parentNode.children[0].setAttribute("style",e.getAttribute("style"))}else throw`没有找到id为${t}的显示元素`}catch(t){console.error(`更改id为${arguments[e]}的input元素值或显示值失败：${t}`)}}}function sentence_type(e){$(".letter_opt, .quote_opt").hide();switch(e){case"quote":$(".quote_opt").show();$("#text").removeClass("letter");$("#text").attr("data-letter-b","");$("#text").attr("data-letter-e","");cssvar_change("text-align","center","text-indent","0em","text-color","#4d4135","text-padding1","6.5em","text-padding2","3.5em");break;case"notice":cssvar_change("font-family","方正仿宋","title-font-family","方正小标宋");case"letter":$(".letter_opt").show();$("#text").addClass("letter");$("#text").attr("data-letter-b","11");$("#text").attr("data-letter-e","2");cssvar_change("text-align","left");cssvar_change("text-indent","2em");pic_change("linear-gradient(rgb(249, 233, 220), rgb(249, 233, 220))");cssvar_change("text-color","#4d4135","border-style","solid","border-color","#dfd6c5","text-padding1","2.5em","text-padding2","0.9em");break}e=="letter"&&cssvar_change("font-family","思源宋体","title-font-family","inherit")}function letter_begin(e,t){e=e?"1":"0";t=t?"1":"0";$("#text").attr("data-letter-b",e+t)}function letter_end(e,t){e=e?1:0;t=t?1:0;$("#text").attr("data-letter-e",e+t)}function capture(e=0){if(!document.getElementById("pic").complete){Swal.fire({icon:"error",title:"背景图片尚未加载完成",html:"请等待背景图片加载完成，或更换背景为渐变填充。",showConfirmButton:true});return false}$("#filter,#result").css("border-radius",0);Swal.fire({icon:"info",title:"请稍后",html:"图片生成中",showConfirmButton:false,timer:2e4,timerProgressBar:true,allowOutsideClick:false}).then((e=>{if(e.dismiss===Swal.DismissReason.timer){Swal.fire("请再试一次","超时","error")}}));var t=document.getElementById("result");var r={scale:e==2?1:2.5};domtoimage.toPng(t,r).then((function(t){let r=new Image;r.src=t;switch(e){case 1:Swal.fire({title:"预览图片",html:`<img src="${t}" alt="生成图片" style="max-width:100%">`,showConfirmButton:true,confirmButtonText:"下载",cancelButtonText:"取消",showCloseButton:true,showCancelButton:true,allowOutsideClick:false}).then((e=>{if(e.value){if(ua.match(/MicroMessenger/i)=="micromessenger"){alert("请长按图片保存")}else{i("分享图片",t)}}}));break;case 2:o(t);break;case 3:a(t);break;default:i("分享图片",t);break}$("#filter,#result").css("border-radius","5px")})).catch((function(e){console.warn(e);Swal.fire({icon:"error",title:"请再试一次",html:"若错误持续出现，请更换背景图片。",footer:"错误信息："+e.toString()})}));function i(e,t){var r=document.createElement("a");r.href=t;r.download=e;let i=document.createEvent("MouseEvents");i.initMouseEvent("click",true,false,window,0,0,0,0,0,false,false,false,false,0,null);r.dispatchEvent(i);Swal.fire({icon:"success",title:"即将弹出下载窗口",timer:3e3})}function o(e){AV.init({appId:"3yz9VMMFTU7t2AjXwqOzRtJK-MdYXbMMI",appKey:"yWPKu7eizq6iQgRWuBlpRyPa",serverURL:"https://leancloud.lzc2002.tk",serverURLs:"https://leancloud.lzc2002.tk"});const t=AV.Object.extend("Poster");const r=new t;let i=document.getElementById("content").innerText;let o=document.getElementById("foot").innerText;let a=typeof returnCitySN!=="undefined"&&returnCitySN["cip"]?returnCitySN["cip"]:"-1";r.set("content",i);r.set("foot",o);r.set("dataurl",e);r.save().then((e=>{console.log(`保存成功。objectId: ${e.id}`);Swal.fire({icon:"success",title:"上传成功",html:`存档编号: ${e.id}`,confirmButtonText:"去看看",showCancelButton:true,cancelButtonText:"好的"}).then((e=>{if(e.value)window.open("/2022/1231/folder-others/ju-zhai-jie-guo/")}))}),(e=>{console.error("leancloud error:"+e);Swal.fire({icon:"error",title:"上传失败",confirmButtonText:"好的"})}))}async function a(e){const t=await fetch(e);const r=await t.blob();await navigator.clipboard.write([new ClipboardItem({[r.type]:r})]).then((()=>{Swal.fire({icon:"success",title:"复制成功",timer:3e3})}),(e=>{let t=e.toString().indexOf("Write permission denied")>-1?true:false;Swal.fire({title:t?"请允许剪切板权限":"复制失败",html:t?"剪切板访问被拒绝":"请直接下载图片",icon:"error",footer:e});console.error(e)}))}}function random_quote(){const e={a:"japanese cartoon",b:"comic",c:"video game",d:"literature",e:"original",f:"blur",g:"wallpaper",h:"film",i:"中国风",j:"cloud",k:"philosophy",l:"snarky"};$.get("https://v1.hitokoto.cn/?time="+(new Date).getTime(),(function(t,r){$("#content").text(t.hitokoto);$("#foot").text(`${t.from_who?t.from_who:t.creator}《${t.from}》`);cssvar_change("filter-bright","0.4");let i="",o=100;$.get(`https://pixabay.com/api/?key=6295509-b67e3d655066dca3360851316&per_page=${o}&q=${e[t.type]}`,(function(r,a){try{let e=Math.floor(Math.random()*o);i=r.hits[e].webformatURL}catch(r){console.error(r);i="https://source.unsplash.com/800x0/?"+e[t.type]+"&"+(new Date).getTime()}pic_change(`url(${i})`)}))}))}