$(document).ready((function(){$(".collapsible").collapsible();$("select").formSelect();$(".pic-eg").on("click",(function(){let e=$(this).css("background-image");pic_change(e)}))}));function pic_change(e){$("#result,#toppic").css("background-image",e);document.getElementById("pic").src=t(e);function t(e){var t=e;var n=/url\((.*)\)/;var o="";try{o=n.exec(t)[1].trim();o=o.replace(/["']/g,"")}catch(e){o="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}return o}}function text_change(e,t){let n="";try{n=marked.parse(e)}catch(t){n=`<p>${e}</p>`;console.log("md解析失败"+t)}$(`#${t}`).html(n.replace(/\n/g,"</p><p>"))}function text_style(e,t){$(`#text`).css(e,t)}$("#hyphen_switch").change((function(){alert("成功触发checkbox改变事件")}));Boolean.prototype.center_left=function(){return this.valueOf()==true?"center":"left"};Boolean.prototype.indent20=function(){return this.valueOf()==true?"2em":"0em"};Boolean.prototype.inline_none=function(){return this.valueOf()==true?"inline":"none"};Boolean.prototype.bold_normal=function(){return this.valueOf()==true?"bold":"normal"};function pic_source_type(e){$("[id*=pic_source_type]").hide();$(`#pic_source_type${e}`).show();if(e<=1)$("#tab3li").hide();else $("#tab3li").show();$(".tabs").tabs("updateTabIndicator")}function random_keyword(e){let t="";$.get(`https://pixabay.com/api/?key=6295509-b67e3d655066dca3360851316&per_page=10&q=${e}`,(function(n,o){for(i=0;i<9;i++){try{t+=`<div class="pic-eg" style="background-image:url('${n.hits[i].webformatURL}')"></div>`}catch(n){console.error(n);t+=`<div class="pic-eg" style="background-image:url('https://source.unsplash.com/80${i}x0/?${e}')"></div>`}}$("#pic_search_res").html(t);$(".pic-eg").on("click",(function(){let e=$(this).css("background-image");pic_change(e)}))}))}function pic_upload(e){var t=e.files[0];var n=window.URL.createObjectURL(t);pic_change(`url(${n})`)}function filter_reset(){document.getElementById("pic").setAttribute("style","");const e=[1,0,0,1,0,1,0];for(i=0;i<e.length;i++){$(`#tab3 div:eq(${i}) input`).val(`${e[i]}`);$(`#tab3 div:eq(${i}) span:eq(1)`).text(`${e[i]}`)}}function cssvar_change(e,t){let n="";if(e.indexOf("filter")>-1)n="pic";else n="result";document.getElementById(n).style.setProperty(`--${e}`,t)}function sentence_type(e){$(".letter_opt, .quote_opt").hide();switch(e){case"quote":$(".quote_opt").show();$("#text").removeClass("letter");$("#text").attr("data-letter-b","");$("#text").attr("data-letter-e","");$("#align_switch").prop("checked",1);$("#indent_switch").prop("checked",0);break;case"letter":$(".letter_opt").show();$("#text").addClass("letter");$("#text").attr("data-letter-b","11");$("#text").attr("data-letter-e","2");$("#align_switch").prop("checked",false);$("#indent_switch").prop("checked",true);pic_change("linear-gradient(rgb(249, 233, 220), rgb(249, 233, 220))");cssvar_change("text-color","#4d4135");cssvar_change("border-style","solid");cssvar_change("border-color","#dfd6c5");break}}function letter_begin(e,t){e=e?"1":"0";t=t?"1":"0";$("#text").attr("data-letter-b",e+t)}function letter_end(e,t){e=e?1:0;t=t?1:0;$("#text").attr("data-letter-e",e+t)}function capture(e=0){if(!document.getElementById("pic").complete){Swal.fire({icon:"error",title:"背景图片尚未加载完成",html:"请等待背景图片加载完成，或更换背景为渐变填充。",showConfirmButton:true});return false}$("#filter,#result").css("border-radius",0);Swal.fire({icon:"info",title:"请稍后",html:"图片生成中",showConfirmButton:false,timer:15e3,timerProgressBar:true});var t=document.getElementById("result_wrapper");var n={scale:e==2?1:2.5};domtoimage.toPng(t,n).then((function(t){let n=new Image;n.src=t;switch(e){case 1:var c=window.open("","location=no","",false);c.document.head.innerHTML="<title>图片预览</title>";c.document.body.innerHTML=`右键点击（或长按图片）以保存<br>若图片生成错误，您可尝试重新生成。<br><img src="${n.src}" alt="生成图片"><script>window.onbeforeunload = function(e) {var dialogText = '刷新将删除图片';e.returnValue = dialogText;return dialogText;};<\/script>`;break;case 2:r(t);break;default:o("分享图片",t);break}Swal.fire({icon:"success",title:"成功",timer:3e3});$("#filter,#result").css("border-radius","5px")})).catch((function(e){console.error(e);Swal.fire({icon:"error",title:"图片生成失败",html:"错误信息："+e})}));function o(e,t){var n=document.createElement("a");n.href=t;n.download=e;let o=document.createEvent("MouseEvents");o.initMouseEvent("click",true,false,window,0,0,0,0,0,false,false,false,false,0,null);n.dispatchEvent(o)}function r(e){AV.init({appId:"3yz9VMMFTU7t2AjXwqOzRtJK-MdYXbMMI",appKey:"yWPKu7eizq6iQgRWuBlpRyPa",serverURL:"https://leancloud.lzc2002.tk",serverURLs:"https://leancloud.lzc2002.tk"});const t=AV.Object.extend("Poster");const n=new t;let o=document.getElementById("content").innerText;let r=document.getElementById("foot").innerText;let c=typeof returnCitySN!=="undefined"&&returnCitySN["cip"]?returnCitySN["cip"]:"-1";n.set("content",o);n.set("foot",r);n.set("dataurl",e);n.save().then((e=>{console.log(`保存成功。objectId: ${e.id}`);Swal.fire({icon:"success",title:"上传成功",html:`存档编号: ${e.id}`,confirmButtonText:"去看看",showCancelButton:true,cancelButtonText:"好的"}).then((e=>{if(e.value)window.open("/2022/1231/folder-others/ju-zhai-jie-guo/")}))}),(e=>{console.error("leancloud error:"+e);Swal.fire({icon:"error",title:"上传失败",confirmButtonText:"好的"})}))}}function random_quote(){const e={a:"japanese cartoon",b:"comic",c:"video game",d:"literature",e:"original",f:"blur",g:"wallpaper",h:"film",i:"中国风",j:"cloud",k:"philosophy",l:"snarky"};$.get("https://v1.hitokoto.cn/?time="+(new Date).getTime(),(function(t,n){$("#content").text(t.hitokoto);$("#foot").text(`${t.from_who?t.from_who:t.creator}《${t.from}》`);document.getElementById("pic").setAttribute("style","--filter-bright:0.4");let o="",r=100;$.get(`https://pixabay.com/api/?key=6295509-b67e3d655066dca3360851316&per_page=${r}&q=${e[t.type]}`,(function(n,c){try{let e=Math.floor(Math.random()*r);o=n.hits[e].webformatURL}catch(n){console.error(n);o="https://source.unsplash.com/800x0/?"+e[t.type]+"&"+(new Date).getTime()}pic_change(`url(${o})`)}))}))}